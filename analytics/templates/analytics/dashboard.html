{% extends 'base.html' %}

{% block title %}Analytics Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">Analytics Dashboard</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white p-6 rounded shadow"><h3 class="font-semibold">Total Revenue</h3><p class="text-2xl">${{ total_revenue|floatformat:2 }}</p></div>
        <div class="bg-white p-6 rounded shadow"><h3 class="font-semibold">Total Orders</h3><p class="text-2xl">{{ total_orders }}</p></div>
        <div class="bg-white p-6 rounded shadow"><h3 class="font-semibold">Low Stock</h3><p class="text-2xl">{{ low_stock_count }}</p></div>
        <div class="bg-white p-6 rounded shadow"><h3 class="font-semibold">Active Customers</h3><p class="text-2xl">{{ active_customers }}</p></div>
    </div>
    
    <div class="bg-white p-6 rounded shadow mb-8">
        <h2 class="text-xl font-bold mb-4">Revenue Trend</h2>
        <canvas id="revenueChart" height="200"></canvas>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="bg-white p-6 rounded shadow">
            <h2 class="text-xl font-bold mb-4">Top Products</h2>
            <table class="w-full"><thead><tr><th>Name</th><th>Sales</th></tr></thead><tbody>{% for p in top_products %}<tr><td>{{ p.products_name }}</td><td>{{ p.sales_count }}</td></tr>{% endfor %}</tbody></table>
        </div>
        <div class="bg-white p-6 rounded shadow">
            <h2 class="text-xl font-bold mb-4">Inventory Status</h2>
            <canvas id="inventoryPie" height="200"></canvas>
        </div>
    </div>
    
    <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Recent Orders</h2>
        <table class="w-full"><thead><tr><th>#</th><th>Customer</th><th>Total</th><th>Status</th></tr></thead><tbody>{% for o in recent_orders %}<tr><td>{{ o.order_number }}</td><td>{{ o.customer_name }}</td><td>${{ o.total }}</td><td>{{ o.get_order_status_display }}</td></tr>{% endfor %}</tbody></table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart('revenueChart', {type: 'line', data: {labels: {{ revenue_dates|safe }}, datasets: [{label: 'Revenue', data: {{ revenue_values|safe }} }]}});
new Chart('inventoryPie', {type: 'pie', data: {labels: ['In Stock', 'Low', 'Out'], datasets: [{data: [{{ in_stock_count }}, {{ low_stock_count }}, {{ out_of_stock_count }}]}]}});
</script>
{% endblock %}
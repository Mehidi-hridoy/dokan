{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/forms.css' %}">
    <style>
        .price-update-form {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 4px;
        }
        .price-update-form .form-row {
            padding: 8px 0;
        }
        .price-update-form label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .price-update-form select,
        .price-update-form input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .products-list {
            margin: 20px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .submit-row {
            text-align: right;
            padding: 20px 0;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="price-update-form">
        <h1>{{ title }}</h1>
        {% if subtitle %}<h2>{{ subtitle }}</h2>{% endif %}
        
        <div class="products-list">
            <h3>Selected Products:</h3>
            <ul>
                {% for product in products %}
                    <li>{{ product.products_name }} (Current Base Price: {{ product.base_price }})</li>
                {% endfor %}
            </ul>
        </div>

        <form action="" method="post">
            {% csrf_token %}
            
            {% for field in form %}
                <div class="form-row">
                    {{ field.errors }}
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field }}
                    {% if field.help_text %}
                        <p class="help">{{ field.help_text }}</p>
                    {% endif %}
                </div>
            {% endfor %}

            <div class="submit-row">
                <input type="hidden" name="action" value="{{ action }}" />
                <input type="submit" name="apply" value="Update Prices" class="default" />
                <a href="" class="button cancel-link">Cancel</a>
            </div>
        </form>
    </div>

    <script type="text/javascript">
        // Dynamic form behavior
        document.addEventListener('DOMContentLoaded', function() {
            var updateTypeSelect = document.querySelector('select[name="update_type"]');
            var operationSelect = document.querySelector('select[name="operation"]');
            var amountInput = document.querySelector('input[name="amount"]');
            
            function updateAmountLabel() {
                var isPercentage = updateTypeSelect.value === 'percentage';
                var operation = operationSelect.value;
                
                // Update amount input step and placeholder
                if (isPercentage) {
                    amountInput.step = '0.1';
                    amountInput.placeholder = 'Enter percentage';
                } else {
                    amountInput.step = '0.01';
                    amountInput.placeholder = 'Enter amount';
                }
                
                // Disable "Set to" operation for percentage
                var setOption = operationSelect.querySelector('option[value="set"]');
                if (isPercentage) {
                    setOption.disabled = true;
                    if (operation === 'set') {
                        operationSelect.value = 'increase';
                    }
                } else {
                    setOption.disabled = false;
                }
            }
            
            updateTypeSelect.addEventListener('change', updateAmountLabel);
            operationSelect.addEventListener('change', updateAmountLabel);
            
            // Initial setup
            updateAmountLabel();
        });
    </script>
{% endblock %}